"use strict";var _arg=_interopRequireDefault(require("arg"));Object.defineProperty(exports,"__esModule",{value:!0}),exports.cli=cli;function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var crypto=require("crypto"),fs=require("fs"),path=require("path"),uuid=require("uuid");function parseArgumentsIntoOptions(a){var b=(0,_arg["default"])({"--major":String,"--minor":String,"--patch":String,"--user":String,"--expire":String,"--public":String,"--private":String,"--license":String,"--output":String,"--private-key":String,"--public-key":String,"-ma":"--major","-mi":"--minor","-p":"--patch","-u":"--user","-e":"--expire","-pu":"--public","-pr":"--private","-l":"--license","-o":"--output","-pk":"--private-key","-pubk":"--public-key"},{permissive:!1,argv:a.slice(2),stopAtPositional:!1});return{major:b["--major"]||"*",minor:b["--minor"]||"*",patch:b["--patch"]||"*",user:b["--user"]||"",expire:b["--expire"]||"",public:b["--public"]||"public.key",private:b["--private"]||"private.key",license:b["--license"]||"license.data",output:b["--output"]||process.cwd(),privateKey:b["--private-key"]||null,publicKey:b["--public-key"]||null}}var cryptoKeyPairOptions={modulusLength:4096,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}};function cli(a){var b=parseArgumentsIntoOptions(a),c=b.user;if(!c)throw new Error("Please pass an email of the user");var d,e,f={id:uuid.v4(),major:b.major,minor:b.minor,patch:b.patch,user:c,created:Date.now(),expire:b.expire},g=b.privateKeyPath,h=b.publicKeyPath;if(g&&h)d=fs.readFileSync(g),e=fs.readFileSync(h);else{var m=crypto.generateKeyPairSync("rsa",cryptoKeyPairOptions);e=m.publicKey,d=m.privateKey}var i=crypto.privateEncrypt(d,Buffer.from(JSON.stringify(f))),j=path.join(b.output,b["public"]),k=path.join(b.output,b["private"]),l=path.join(b.output,b.license);console.log("Saving public key file to '".concat(j,"'.")),fs.writeFileSync(j,e),console.log("Saving private key file to '".concat(k,"'.")),fs.writeFileSync(k,d),console.log("Saving license file to '".concat(l,"'.")),fs.writeFileSync(l,i)}